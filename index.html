<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cookie Clicker - Secure Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            background-color: #121212;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        #game-container {
            display: none; /* Giri≈ü yapana kadar gizli */
            width: 100vw; height: 100vh;
            background: url('Background.png') no-repeat center center;
            background-size: cover;
            position: relative;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* LOGIN EKRANI */
        #name-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1e1e1e 0%, #000 100%);
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box {
            background: rgba(255,255,255,0.05); padding: 40px; border-radius: 25px;
            border: 1px solid rgba(249, 212, 35, 0.3); text-align: center; width: 300px;
            backdrop-filter: blur(10px);
        }
        .login-input { 
            width: 90%; padding: 15px; margin: 10px 0; border-radius: 12px; 
            border: 1px solid #333; background: #111; color: white; text-align: center;
        }
        #start-btn { 
            margin-top: 20px; padding: 15px 50px; background: #f9d423; 
            border: none; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%;
        }

        /* ADMIN PANEL */
        #admin-panel {
            display: none; position: fixed; bottom: 80px; left: 20px;
            background: rgba(10,10,10,0.95); border: 2px solid #f9d423;
            padding: 20px; border-radius: 20px; z-index: 3000; width: 280px;
            color: white; box-shadow: 0 0 30px rgba(249, 212, 35, 0.4);
        }
        .admin-input { width: 90%; padding: 8px; margin: 5px 0; border-radius: 8px; border: 1px solid #444; background: #000; color: #0f0; }
        .admin-btn { width: 100%; padding: 10px; background: #f9d423; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 5px; }

        /* DIGER STYLES (Ozetlenmis) */
        #score-board { position: absolute; top: 6%; left: 20px; background: rgba(255,255,255,0.1); padding: 10px 25px; border-radius: 50px; color: white; border: 1px solid rgba(255,255,255,0.2); z-index: 100; display: flex; align-items: center; gap: 10px; }
        .score-icon { width: 30px; }
        #main-cookie { width: min(80vw, 320px); transition: transform 0.1s; cursor: pointer; }
        #menu-btn { position: absolute; top: 6%; right: 20px; width: 50px; height: 50px; background: rgba(255,255,255,0.1); border-radius: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 5px; z-index: 1000; }
        #menu-btn span { width: 25px; height: 3px; background: white; }
        #social-panel { position: fixed; top: 0; right: -100%; width: 100%; height: 100%; background: #0a0a0ae6; z-index: 2000; transition: 0.5s; color: white; padding: 20px; box-sizing: border-box; overflow-y: auto;}
        #social-panel.open { right: 0; }
        .leader-item { display: flex; justify-content: space-between; padding: 10px; background: rgba(255,255,255,0.05); margin: 5px 0; border-radius: 8px; }
        #chat-box { height: 150px; background: #000; overflow-y: auto; padding: 10px; margin-bottom: 10px; border-radius: 10px; }
        #admin-announcement { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); width: 80%; background: #ff3e3e; color: white; padding: 15px; border-radius: 15px; text-align: center; z-index: 9999; transition: 0.5s; }
        #admin-announcement.show { top: 20px; }
    </style>
</head>
<body>

    <div id="admin-announcement">Admin: <span>...</span></div>

    <div id="name-overlay">
        <div class="login-box">
            <h2 style="color: #f9d423; margin-top: 0;">OYUNCU Gƒ∞Rƒ∞≈ûƒ∞</h2>
            <input type="text" id="name-input" class="login-input" placeholder="ƒ∞sim Yaz..." maxlength="15">
            <input type="password" id="pass-input" class="login-input" placeholder="≈ûifre Belirle/Gir...">
            <p id="login-info" style="color: #888; font-size: 11px;">Yeni isim girerseniz ≈üifreniz bu olacaktƒ±r.</p>
            <button id="start-btn" onclick="handleAuth()">OYUNA Gƒ∞R</button>
        </div>
    </div>

    <div id="admin-panel">
        <b style="color:#f9d423">STAFF PANEL</b>
        <input type="text" id="admin-msg-input" class="admin-input" placeholder="Global Duyuru...">
        <button class="admin-btn" onclick="sendAdminGlobal()">YAYINLA</button>
        <hr style="border:0.5px solid #333; margin:10px 0;">
        <label style="font-size:12px">OYUNCUYA PARA G√ñNDER:</label>
        <input type="text" id="target-player" class="admin-input" placeholder="Oyuncu Adƒ±...">
        <input type="number" id="target-amount" class="admin-input" placeholder="Miktar...">
        <button class="admin-btn" style="background:#4facfe" onclick="giveCashAdmin()">G√ñNDER</button>
        <button class="admin-btn" style="background:#666; color:white" onclick="this.parentElement.style.display='none'">KAPAT</button>
    </div>

    <div id="game-container">
        <div id="score-board"><img src="Cookie.png" class="score-icon"><span id="score-text">0</span></div>
        <div id="menu-btn" onclick="toggleMenu()"><span></span><span></span><span></span></div>
        <img src="Cookie.png" id="main-cookie" onclick="processEat()">
        
        <div style="position: absolute; bottom: 20px; display: flex; gap: 10px;">
            <button onclick="toggleStore()" style="padding: 15px 30px; border-radius: 20px; border:none; background: #f9d423; font-weight: bold;">STORE</button>
        </div>
    </div>

    <div id="social-panel">
        <h2 onclick="toggleMenu()">‚úï GERƒ∞ D√ñN</h2>
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px;">
            <h3>Lƒ∞DERLƒ∞K TABLOSU</h3>
            <div id="leaderboard-list"></div>
        </div>
        <br>
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px;">
            <h3>GLOBAL SOHBET</h3>
            <div id="chat-box"></div>
            <input type="text" id="chat-input" placeholder="Mesaj..." style="width: 70%; padding: 10px; border-radius: 5px;">
            <button onclick="sendMessage()" style="padding: 10px; background: #f9d423; border:none; border-radius: 5px;">G√ñNDER</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDUBBEwbyi80Y9qcuM7fhrXN8h-wGipnlU",
      authDomain: "leaderboard-010011.firebaseapp.com",
      databaseURL: "https://leaderboard-010011-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "leaderboard-010011",
      storageBucket: "leaderboard-010011.firebasestorage.app",
      messagingSenderId: "654873144400",
      appId: "1:654873144400:web:3bde56d0ef6ef754493555"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let playerName = "";
    let score = 0;
    let biteStage = 0;
    let isCooldown = false;

    // Gƒ∞Rƒ∞≈û VE ≈ûƒ∞FRE KONTROL√ú
    async function handleAuth() {
        const nameInput = document.getElementById('name-input').value.trim();
        const passInput = document.getElementById('pass-input').value.trim();
        const info = document.getElementById('login-info');

        if(nameInput.length < 3 || passInput.length < 3) {
            alert("ƒ∞sim ve ≈ûifre en az 3 karakter olmalƒ±!");
            return;
        }

        const userRef = database.ref('users/' + nameInput);
        const snapshot = await userRef.get();

        if(snapshot.exists()) {
            // Kullanƒ±cƒ± var, ≈üifre kontrol√º yap
            if(snapshot.val().password === passInput) {
                loginSuccess(nameInput);
            } else {
                info.style.color = "#ff3e3e";
                info.innerText = "HATA: Bu isim alƒ±nmƒ±≈ü ve ≈üifre yanlƒ±≈ü!";
            }
        } else {
            // Yeni kullanƒ±cƒ± olu≈ütur
            await userRef.set({
                password: passInput,
                score: 0
            });
            loginSuccess(nameInput);
        }
    }

    function loginSuccess(name) {
        playerName = name;
        document.getElementById('name-overlay').style.display = 'none';
        document.getElementById('game-container').style.display = 'flex';
        
        // Verileri Dinle
        database.ref('users/' + playerName + '/score').on('value', snap => {
            score = snap.val() || 0;
            document.getElementById('score-text').innerText = score;
        });

        if(playerName.toLowerCase() === "ibrahim deve") {
            document.getElementById('admin-panel').style.display = 'block';
        }

        initSocial();
    }

    // ADMIN: PARA G√ñNDERME
    function giveCashAdmin() {
        const target = document.getElementById('target-player').value.trim();
        const amount = parseInt(document.getElementById('target-amount').value);
        
        if(!target || isNaN(amount)) return;

        database.ref('users/' + target).get().then(snap => {
            if(snap.exists()) {
                const newScore = (snap.val().score || 0) + amount;
                database.ref('users/' + target).update({ score: newScore });
                alert(target + " oyuncusuna " + amount + " g√∂nderildi!");
            } else {
                alert("Oyuncu bulunamadƒ±!");
            }
        });
    }

    function processEat() {
        if(isCooldown) return;
        isCooldown = true;
        setTimeout(() => isCooldown = false, 500);

        biteStage++;
        if(biteStage >= 4) {
            biteStage = 0;
            database.ref('users/' + playerName).update({ score: score + 1 });
        }
        document.getElementById('main-cookie').style.transform = "scale(0.9)";
        setTimeout(() => document.getElementById('main-cookie').style.transform = "scale(1)", 100);
    }

    function sendAdminGlobal() {
        const msg = document.getElementById('admin-msg-input').value;
        database.ref('admin_msg').set({ text: msg, time: Date.now() });
    }

    function initSocial() {
        // Liderlik Tablosu
        database.ref('users').orderByChild('score').limitToLast(10).on('value', snap => {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = "";
            let items = [];
            snap.forEach(c => { items.push({n: c.key, s: c.val().score}); });
            items.reverse().forEach((p, i) => {
                list.innerHTML += `<div class="leader-item">#${i+1} ${p.n} <span>${p.s} üç™</span></div>`;
            });
        });

        // Chat
        database.ref('messages').limitToLast(10).on('value', snap => {
            const box = document.getElementById('chat-box'); box.innerHTML = "";
            snap.forEach(c => { box.innerHTML += `<div><b>${c.val().n}:</b> ${c.val().t}</div>`; });
            box.scrollTop = box.scrollHeight;
        });

        // Admin Duyurularƒ±
        database.ref('admin_msg').on('value', snap => {
            if(!snap.val()) return;
            const b = document.getElementById('admin-announcement');
            b.querySelector('span').innerText = snap.val().text;
            b.classList.add('show');
            setTimeout(() => b.classList.remove('show'), 5000);
        });
    }

    function sendMessage() {
        const t = document.getElementById('chat-input').value;
        if(!t) return;
        database.ref('messages').push({ n: playerName, t: t });
        document.getElementById('chat-input').value = "";
    }

    function toggleMenu() { document.getElementById('social-panel').classList.toggle('open'); }
    function toggleStore() { alert("Store yakƒ±nda!"); }
</script>
</body>
</html>
