<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Modern Cookie Clicker - Ultimate Social Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            background-color: #121212;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* OYUN KONTEYNERI */
        #game-container {
            display: none; 
            width: 100vw; height: 100vh;
            background: url('Background.png') no-repeat center center;
            background-size: cover;
            position: relative;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Gƒ∞Rƒ∞≈û EKRANI */
        #name-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #121212; z-index: 5000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 40px; border-radius: 30px; border: 2px solid #f9d423;
            text-align: center; width: 320px;
        }
        .login-input { 
            padding: 18px; font-size: 16px; border-radius: 15px; border: 2px solid #333; 
            width: 100%; margin-bottom: 15px; background: #1a1a1a; color: white; box-sizing: border-box;
            text-align: center;
        }
        #start-btn { 
            width: 100%; padding: 18px; background: #f9d423; border: none; 
            border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 18px;
        }

        /* ADMIN VE DIGER GORSEL STILLER (SENIN KODUNUN AYNISI) */
        #admin-announcement {
            position: fixed; top: -120px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; background: linear-gradient(135deg, #ff3e3e, #b91d1d);
            color: white; padding: 18px; border-radius: 20px; text-align: center;
            font-weight: 600; z-index: 9999; transition: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        #admin-announcement.show { top: 30px; }
        #admin-panel {
            display: none; position: fixed; bottom: 80px; left: 20px;
            background: rgba(15,15,15,0.98); border: 2px solid #f9d423;
            padding: 20px; border-radius: 20px; z-index: 3000; width: 300px; color: white;
        }
        .admin-input { width: 92%; padding: 10px; margin: 5px 0; border-radius: 10px; border: 1px solid #333; background: #000; color: #f9d423; }
        .admin-btn { width: 100%; padding: 12px; background: #f9d423; color: black; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        #score-board { position: absolute; top: 6%; left: 20px; background: rgba(255, 255, 255, 0.12); padding: 12px 30px; border-radius: 100px; color: #ffffff; border: 2px solid rgba(255, 255, 255, 0.3); z-index: 100; display: flex; align-items: center; gap: 15px; }
        .score-icon { width: 35px; height: 35px; }
        #score-text { font-size: 2rem; font-weight: 600; }
        #menu-btn { position: absolute; top: 6%; right: 20px; width: 55px; height: 55px; background: rgba(255, 255, 255, 0.15); border-radius: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 6px; z-index: 1100; }
        #menu-btn span { width: 30px; height: 3px; background: white; }
        #social-panel { position: fixed; top: 0; right: -100%; width: 100%; height: 100%; background: rgba(10,10,10,0.98); z-index: 2000; transition: 0.6s; color: white; padding: 40px 20px; box-sizing: border-box; overflow-y: auto; }
        #social-panel.open { right: 0; }
        #chat-box { height: 180px; background: rgba(0,0,0,0.4); border-radius: 15px; overflow-y: auto; padding: 15px; margin-bottom: 12px; }
        #cookie-container { position: relative; width: 320px; height: 320px; display: flex; justify-content: center; align-items: center; }
        #main-cookie { width: 100%; transition: transform 0.12s; }
        .controls { position: absolute; bottom: 8%; display: flex; flex-direction: column; gap: 20px; width: 100%; align-items: center; }
        .ui-btn { width: 160px; cursor: pointer; }
        #store-ui { position: fixed; top: 0; right: -100%; width: 100%; height: 100%; background: rgba(20,20,20,0.95); z-index: 1500; transition: 0.8s; padding: 40px; color: white; box-sizing: border-box; }
        #store-ui.open { right: 0; }
        .store-item { background: rgba(255, 255, 255, 0.07); padding: 20px; border-radius: 25px; display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
        .particle { position: absolute; pointer-events: none; animation: crumble 1.5s forwards; }
        @keyframes crumble { 100% { transform: translate(var(--tx), var(--ty)) rotate(720deg); opacity: 0; } }
        .fade-out { opacity: 0; transform: scale(0.1) !important; }
        .shake { animation: biteEffect 0.45s ease-out; }
        @keyframes biteEffect { 0%, 100% { transform: scale(1); } 25% { transform: scale(0.9) rotate(-6deg); } 50% { transform: scale(1.1) rotate(6deg); } }
    </style>
</head>
<body>

    <div id="admin-announcement">Admin: <span>...</span></div>

    <div id="name-overlay">
        <div class="login-card">
            <h1 style="color: white; margin-bottom: 10px;">Gƒ∞Rƒ∞≈û YAP</h1>
            <input type="text" id="name-input" class="login-input" placeholder="ƒ∞sim..." maxlength="15">
            <input type="password" id="pass-input" class="login-input" placeholder="≈ûifre...">
            <p id="name-error" style="color: #ff3e3e; font-size: 12px; display: none;">Hata!</p>
            <button id="start-btn" onclick="handleAuth()">OYUNA BA≈ûLA</button>
        </div>
    </div>

    <div id="admin-panel">
        <b style="color:#f9d423">STAFF PANEL</b><br><br>
        <input type="text" id="admin-msg-input" class="admin-input" placeholder="Global Duyuru...">
        <button class="admin-btn" onclick="sendAdminGlobal()">DUYURU YAP</button>
        <hr style="border:0.5px solid #333; margin:10px 0;">
        <input type="text" id="target-player-name" class="admin-input" placeholder="Oyuncu ƒ∞smi...">
        <input type="number" id="target-player-amount" class="admin-input" placeholder="Miktar...">
        <button class="admin-btn" style="background:#4facfe" onclick="giveCashToPlayer()">PARA G√ñNDER</button>
    </div>

    <div id="game-container">
        <div id="menu-btn" onclick="toggleMenu()"><span></span><span></span><span></span></div>
        <div id="score-board"><img src="Cookie.png" class="score-icon"><span id="score-text">0</span></div>
        <div id="cookie-container"><img src="Cookie.png" id="main-cookie" onclick="processEat()"></div>
        <div class="controls">
            <img src="Eat.png" id="eat-btn" class="ui-btn" onclick="processEat()">
            <img src="Store.png" id="store-btn" class="ui-btn" onclick="toggleStore()">
        </div>

        <div id="store-ui">
            <h2 onclick="toggleStore()">‚úï KAPAT</h2>
            <div class="store-item" onclick="buyAutoBite()"><b>Auto Bite</b> (15 üç™)</div>
            <div class="store-item" onclick="buyGrandma()"><b>Grandma</b> (40 üç™)</div>
        </div>
    </div>

    <div id="social-panel">
        <h2 onclick="toggleMenu()">‚úï GERƒ∞</h2>
        <h3>SIRALAMA</h3>
        <div id="leaderboard-list"></div>
        <hr>
        <h3>CHAT</h3>
        <div id="chat-box"></div>
        <input type="text" id="chat-input" placeholder="Mesaj..."><button onclick="sendMessage()">G√∂nder</button>
    </div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDUBBEwbyi80Y9qcuM7fhrXN8h-wGipnlU",
      authDomain: "leaderboard-010011.firebaseapp.com",
      databaseURL: "https://leaderboard-010011-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "leaderboard-010011",
      storageBucket: "leaderboard-010011.firebasestorage.app",
      messagingSenderId: "654873144400",
      appId: "1:654873144400:web:3bde56d0ef6ef754493555"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let playerName = localStorage.getItem('player_name') || "";
    let playerPass = localStorage.getItem('player_pass') || "";
    let score = 0;
    let biteStage = 0;
    let isTransitioning = false;
    let isCooldown = false;
    let grandmaCount = 0;
    let hasAutoBite = false;

    // SAYFA A√áILDIƒûINDA OTOMATƒ∞K Gƒ∞Rƒ∞≈û KONTROL√ú
    window.onload = function() {
        if(playerName && playerPass) {
            autoLogin();
        }
    };

    async function autoLogin() {
        const snapshot = await database.ref('accounts/' + playerName).get();
        if(snapshot.exists() && snapshot.val().password === playerPass) {
            startGame(playerName);
        } else {
            localStorage.clear(); // Hatalƒ± kayƒ±t varsa temizle
        }
    }

    async function handleAuth() {
        const nameInput = document.getElementById('name-input').value.trim();
        const passInput = document.getElementById('pass-input').value.trim();
        if(!nameInput || !passInput) return;

        const snapshot = await database.ref('accounts/' + nameInput).get();
        if(snapshot.exists()) {
            if(snapshot.val().password === passInput) {
                saveToLocal(nameInput, passInput);
                startGame(nameInput);
            } else {
                alert("≈ûifre Yanlƒ±≈ü!");
            }
        } else {
            await database.ref('accounts/' + nameInput).set({ password: passInput, score: 0 });
            saveToLocal(nameInput, passInput);
            startGame(nameInput);
        }
    }

    function saveToLocal(n, p) {
        localStorage.setItem('player_name', n);
        localStorage.setItem('player_pass', p);
    }

    async function startGame(name) {
        playerName = name;
        document.getElementById('name-overlay').style.display = 'none';
        document.getElementById('game-container').style.display = 'flex';
        
        database.ref('accounts/' + playerName).on('value', snap => {
            if(snap.exists()){
                score = snap.val().score || 0;
                grandmaCount = snap.val().grandma || 0;
                hasAutoBite = snap.val().autobite || false;
                document.getElementById('score-text').innerText = score;
            }
        });

        if(playerName.toLowerCase() === "ibrahim deve") document.getElementById('admin-panel').style.display = 'block';
        initSocial();
    }

    function processEat() {
        if (isTransitioning || isCooldown || !playerName) return;
        isCooldown = true;
        setTimeout(() => isCooldown = false, 2000);
        biteStage++;
        if (biteStage >= 4) {
            biteStage = 0;
            addPoints(1);
        }
        document.getElementById('main-cookie').classList.add('shake');
        setTimeout(()=> document.getElementById('main-cookie').classList.remove('shake'), 200);
    }

    function addPoints(val) {
        score += val;
        database.ref('accounts/' + playerName).update({ score: score });
        database.ref('leaderboard/' + playerName).set({ score: score });
    }

    function giveCashToPlayer() {
        const t = document.getElementById('target-player-name').value;
        const a = parseInt(document.getElementById('target-player-amount').value);
        database.ref('accounts/' + t).get().then(s => {
            if(s.exists()){
                database.ref('accounts/' + t).update({ score: s.val().score + a });
                database.ref('leaderboard/' + t).update({ score: s.val().score + a });
            }
        });
    }

    function initSocial() {
        syncLeaderboard();
        listenMessages();
        database.ref('admin_announcement').on('value', snap => {
            if(snap.val()){
                const b = document.getElementById('admin-announcement');
                b.querySelector('span').innerText = snap.val().text;
                b.classList.add('show');
                setTimeout(()=> b.classList.remove('show'), 5000);
            }
        });
    }

    function syncLeaderboard() {
        database.ref('leaderboard').orderByChild('score').limitToLast(10).on('value', snap => {
            const list = document.getElementById('leaderboard-list'); list.innerHTML = "";
            let arr = []; snap.forEach(c => { arr.push({ n: c.key, s: c.val().score }); });
            arr.reverse().forEach((p, i) => { list.innerHTML += `<div>#${i+1} ${p.n}: ${p.s} üç™</div>`; });
        });
    }

    function listenMessages() {
        database.ref('messages').limitToLast(10).on('value', snap => {
            const box = document.getElementById('chat-box'); box.innerHTML = "";
            snap.forEach(c => { box.innerHTML += `<div><b>${c.val().name}:</b> ${c.val().text}</div>`; });
        });
    }

    function sendMessage() {
        const i = document.getElementById('chat-input');
        database.ref('messages').push({ name: playerName, text: i.value });
        i.value = "";
    }

    function toggleMenu() { document.getElementById('social-panel').classList.toggle('open'); }
    function toggleStore() { document.getElementById('store-ui').classList.toggle('open'); }
    function sendAdminGlobal() { database.ref('admin_announcement').set({ text: document.getElementById('admin-msg-input').value }); }
</script>
</body>
</html>
